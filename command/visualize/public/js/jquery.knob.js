$(function(){$.fn.knob=$.fn.dial=function(a){return this.each(function(){var b=$(this);if(b.data("dialed"))return b;b.data("dialed",!0);var c=$.extend({min:b.data("min")||0,max:b.data("max")||100,cursor:b.data("cursor"),thickness:b.data("thickness")||.3,width:b.data("width")||200,displayInput:b.data("displayinput")==null||b.data("displayinput"),fgColor:b.data("fgcolor")||"#87CEEB",bgColor:b.data("bgcolor")||"#EEEEEE",tickColor:b.data("tickColor")||b.data("fgcolor")||"#DDDDDD",ticks:b.data("ticks")||0,tickLength:b.data("tickLength")||0,tickWidth:b.data("tickWidth")||.02,tickColorizeValues:b.data("tickColorizeValues")||!0,readOnly:b.data("readonly"),skin:b.data("skin")||"default",draw:function(a,b,c,d){var e=1.05  *Math.PI,f=e+a,g=c.width/2,h=g*c.thickness;d.clearRect(0,0,c.width,c.width),d.lineWidth=h,c.cursor&&(e=f-.3)&&(f+=.3);var i=c.ticks,j=c.tickLength,k=c.tickWidth;for(tick=0;tick<i;tick++){d.beginPath(),a>2*Math.PI/i*tick&&c.tickColorizeValues?d.strokeStyle=c.fgColor:d.strokeStyle=c.tickColor;var l=2*Math.PI/i*tick-.05  *Math.PI;d.arc(g,g,g-h-j,l,l+k,!1),d.stroke()}d.beginPath(),d.strokeStyle=c.fgColor,d.arc(g,g,g-h,e,f,!1),d.stroke();switch(c.skin){case"default":d.beginPath(),d.strokeStyle=c.bgColor,d.arc(g,g,g-h,e,b==c.min&&!c.cursor?e+1e-4:f,!0),d.stroke();break;case"tron":d.lineWidth=2,d.beginPath(),d.strokeStyle=c.fgColor,d.arc(g,g,g-h+1+h*2/3,0,2*Math.PI,!1),d.stroke()}},change:function(a){},release:function(a,b){}},a),d=$('<canvas width="'+c.width+'" height="'+c.width+'"></canvas>'),e=$("<div style=width:"+c.width+'px;display:inline;"></div>'),f;b.wrap(e).before(d),c.displayInput&&b.css({width:c.width/2+"px",position:"absolute","margin-top":c.width*5/13+"px","margin-left":"-"+3*c.width/4+"px","font-size":c.width/5+"px",border:"none",background:"none","font-family":"Arial","font-weight":"bold","text-align":"center",color:c.fgColor,padding:"0px","-webkit-appearance":"none"})||b.css({width:"0px",visibility:"hidden"}),f=new Dial(d,c),f.onRelease=function(a){c.release(a,b)},f.val(parseInt(b.val())||0),f.onChange=function(a){b.val(a),c.change(a)},b.bind("change",function(a){f.val(b.val())});if(!c.readOnly){d.bind("mousedown touchstart",function(a){a.preventDefault(),f.startDrag(a)}).bind("mousewheel DOMMouseScroll",mw=function(a){a.preventDefault();var c=a.originalEvent,d=c.detail||c.wheelDeltaX,e=c.detail||c.wheelDeltaY,g=parseInt(b.val())+(d>0||e>0?1:d<0||e<0?-1:0);f.val(g)});var g,h,i,j,k=1,l={37:-1,38:1,39:1,40:-1};b.bind("keydown",function(a){var c=a.keyCode;g=parseInt(String.fromCharCode(c)),isNaN(g)&&(c!=13&&c!=8&&c!=189&&a.preventDefault(),$.inArray(c,[37,38,39,40])>-1&&(f.val(parseInt(b.val())+l[c]*k),j=function(){k<20&&k++},i=setTimeout(j,50),a.preventDefault()))}).bind("keyup",function(a){isNaN(g)?i?(clearTimeout(i),i=null,k=1,f.onRelease(b.val(),b)):a.keyCode==13&&f.onRelease(b.val(),b):b.val()>c.max&&b.val(c.max)||b.val()<c.min&&b.val(c.min)}).bind("mousewheel DOMMouseScroll",mw)}else b.attr("readonly","readonly")}).parent()},Dial=function(a,b){var c=null,d=a[0].getContext("2d"),e=Math.PI*1e-4,f=2*Math.PI,g,h,i,j,k=this;this.onChange=function(){},this.onRelease=function(){},this.val=function(a){if(null==a){var k=e=Math.atan2(g-i,-(h-j-b.width/2));return e<0&&(k=e+f),a=Math.round(k*(b.max-b.min)/f)+b.min,a>b.max?b.max:a}a=Math.max(Math.min(a,b.max),b.min);if(c==a)return;c=a,this.onChange(a),e=(a-b.min)*f/(b.max-b.min),b.draw(e,a,b,d)},this.capture=function(a){switch(a.type){case"mousemove":case"mousedown":g=a.pageX,h=a.pageY;break;case"touchmove":case"touchstart":g=a.originalEvent.touches[0].pageX,h=a.originalEvent.touches[0].pageY}this.val(this.val())},this.startDrag=function(d){var e=a.position();i=e.left+b.width/2,j=e.top,this.capture(d),$(document).bind("mousemove.dial touchmove.dial",function(a){k.capture(a)}).bind("mouseup.dial touchend.dial",function(){$(document).unbind("mousemove.dial touchmove.dial mouseup.dial touchend.dial"),k.onRelease(c)})}}})